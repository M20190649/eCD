\section{Local Synchronous Distance Checking} 
\label{sec-localcheck}

%In this section, we first analyze the properties of synchronized points and synchronous Euclidean distances, then we present a local one-pass \sed checking method by extending the cone intersection for \ped checking in Section~\ref{sub-ci-ped}.
%Finally, we provide a one-pass, error-bounded and \sed enabled trajectory simplification algorithm.

In this section, we develop a local synchronous distance checking approach such that each data point in a trajectory is checked only once in $O(1)$ time during the entire process of trajectory simplification, by extending the sector intersection method in Section~\ref{sub-ci-ped}, which lays down the key for the one-pass trajectory simplification algorithms in Section~\ref{sec-alg}.

We consider a sub-trajectory $\dddot{\mathcal{T}}_s[P_s, \ldots, P_{s+k}]$, an error bound $\epsilon$, and a 3D Cartesian coordinate system whose origin, $x$-axis, $y$-axis and $t$-axis  are $P_s$, longitude, latitude and time, respectively.

\subsection{Spatio-Temporal Cone Intersection}

We first present the spatio-temporal cone intersection method in a 3D Cartesian coordinate system, which extends the sector intersection method~\cite{ORourke:Intersection}. %in a 2D Cartesian coordinate system.

%Recall that the \sed of point $P_i$ to a directed line segment $\mathcal{L} = \vv{P_{s}P_{e}}$, denoted as $sed(P_i, \mathcal{L})$, is $|P_iP_i'|$, the distance from $P_i$ to its synchronized point $P_i' (x_i', y_i', t_i)$ \wrt $\mathcal{L}$.




\stitle{Synchronous Circles (\circle{})}. The synchronous circle of a data point $P_{s+i}$ ($1\le i\le k$) in $\dddot{\mathcal{T}}_s$, denoted as \circle{(P_{s+i}, \epsilon)}, is a circle on the plane $P.t-P_{s+i}.t = 0$ such that $P_{s+i}$ is its center and $\epsilon$ is its radius.


It is easy to know that for any point in the area of a circle \circle{(P_{s+i}, \epsilon)}, its distance to $P_{s+i}$ is no greater than $\epsilon$, and
Figure~\ref{fig:cis} shows two synchronous circles \circle{(P_{s+i}, \epsilon)} of point $P_{s+i}$ and \circle{(P_{s+i+1}, \epsilon)} of point $P_{s+i+1}$.

%Note that in this definition, a \emph{synchronous circle} $\mathcal{O}(P_i, \epsilon)$ is only defined by a central point $P_i$ and a constant $\epsilon$. Indeed, it is nothing to do with any start point $P_s$ or end point $P_e$.


\eat{%%%%%%%%%%%%%%%%EAT
With Lemma~\ref{prop-3d-syn-point} and the notion of \emph{synchronous circle}, and from the geometrical perspective, we have Theorem~\ref{prop-3d-sed-sim}.



\begin{theorem}
\label{prop-3d-sed-sim}
Given a sub-trajectory $[P_s, \ldots, P_e]$ and an error bound $\epsilon$, the sub-trajectory can be represented by the line segment $\vv{P_sP_e}$ if and only if the line segment passes through all synchronous circles $\mathcal{O}(P_i, \epsilon)$ for each $i \in (s, e]$.
\end{theorem}

\begin{proof}
As shown in Figure~\ref{fig:sed3d}, let $P'_i$ be the intersection point of line segment $\vv{P_sP_e}$ and plane $t=t_i$.
By Lemma~\ref{prop-3d-syn-point}, point $P'_i$ is the synchronized point of $P_i$ \wrt line segment $\vv{P_sP_e}$.

\ni (1) If the line segment $\vv{P_sP_e}$ passes through all synchronous circles $\mathcal{O}(P_i, \epsilon)$ for $i \in (s, e)$, then by the definition of synchronous circle, it must pass through the circle which is on the plane $t=t_i$ and around point $P_i$, and has a radius of $\epsilon$, thus, $|P'_iP_i| <\epsilon$. Furthermore, the property is hold for each $i \in (s, e)$, hence, the sub trajectory $[P_s, \ldots, P_e]$ can be represented by the line segment $\vv{P_sP_e}$.

\ni (2) If the sub trajectory $[P_s, \ldots, P_e]$ can be represented by the line segment $\vv{P_sP_e}$, then $|P'_iP_i| <\epsilon$ for each $i \in (s, e)$, \ie $P'_i$ is in the synchronous circles $\mathcal{O}(P_i, \epsilon)$. Thus, the line segment $\vv{P_sP_e}$ passes through all synchronous circles $\mathcal{O}(P_i, \epsilon)$ for $i \in (s, e)$.

We have the conclusion.
\end{proof}
}%%%%%%%%%%%%%%%%%%EAT%

%A sub trajectory $\{P_s, \ldots, P_e\}$ is represented by a line segment $\overline{P_sP_e}$
%which passes through the circle on the plane $t=t_i$ and around point $P_i$, for each $s<i<e$.}


%\subsection{Spatio-Temporal Cone Intersection}


\stitle{Spatio-temporal cones (\cone{})}. The spatio-temporal cone (or simply cone) of point $P_{s+i}$ \wrt point $P_s$, denoted as \cone{(P_s, \mathcal{O}(P_{s+i}, \epsilon))}, is an oblique circular cone such that the start point $P_s$ is its apex and the synchronous circle $\mathcal{O}(P_{s+i}, \epsilon)$ is its base.
%
Two example cones \cone{(P_s, \mathcal{O}(P_{s+i}, \epsilon))} and \cone{(P_s, \mathcal{O}(P_{i+1}, \epsilon))} are illustrated in Figure~\ref{fig:cis}.

\stitle{Cone projection circles}. The projection of a cone \cone{(P_s, \mathcal{O}(P_{s+i}, \epsilon))} on a plane $P.t- t_c = 0$ ($t_c > P_s.t$) is a circle \pcircle{(P^c_i, r^c_i)} such that
%
(1) $P^c_i.x = P_s.x +  c\cdot(P_{s+i}.x- P_{s}.x)$, 
%
(2) $P^c_i.y = P_s.y +  c\cdot(P_{s+i}.y- P_{s}.y)$, 
%
(3) $P^c_i.t = t_c$ and
%
(4) $r^c_i =c\cdot\epsilon$, where $c=\frac{t_c - P_s.t}{P_{s+i}.t - P_s.t}$.


The red dashed circle\pcircle{(P^c_{i+1}, r^c_{i+1})} on plane $t=t_i$ in Figure~\ref{fig:cis} is the projection circle of cone \cone{(P_s, \mathcal{O}(P_i, \epsilon))}.


%\begin{figure}[tb!]
%\centering
%\includegraphics[scale=0.56]{figures/Fig-SEDin3D.png}
%\vspace{-1ex}
%\caption{\small Trajectory simplification in the Spatio-temporal space. Note the synchronous circle $\mathcal{O}(P_i, \epsilon)$ is on plane $t=t_i$.} %
%\vspace{-3ex}
%\label{fig:sed3d}
%\end{figure}



We are now ready to extend the \emph{sector intersection} method \cite{Williams:Longest, Sklansky:Cone, Zhao:Sleeve} from a 2D space to a 3D space.

%\textcolor[rgb]{1.00,0.00,0.00}{The \sed is demonstrated in 2D space in the previews works~\cite{Meratnia:Spatiotemporal, Chen:Fast, Muckell:Compression, Popa:Spatio}. However,  the trajectory and the \sed are also capable presented in 3D space.}

\begin{lemma}
\label{prop-3d-syn-point}
Given a sub-trajectory $[P_s, \ldots, P_{s+k}]$, the intersection point $P'_{s+i}$ of the directed line segment $\vv{P_sP_{s+k}}$ and the plane $P.t - P_{s+i}.t = 0$ is the synchronized data point of $P_{s+i}$ ($1\le i\le k$) \wrt  $\vv{P_sP_{s+k}}$, and the distance $|\vv{P_{s+i}P'_{s+i}}|$ from $P_{s+i}$ to $P'_{s+i}$ is the synchronous distance of $P_{s+i}$ to $\vv{P_sP_{s+k}}$.
%in the spatio-temporal space.
\end{lemma}

\begin{proof} It suffices to show that $P'_{s+i}$ is indeed a synchronized data point $P_{s+i}$ \wrt $\vv{P_sP_{s+k}}$.
%
The intersection point $P'_{s+i}$ satisfies that $P'_{s+i}.t = P_{s+i}.t$ and 
$\frac{P'_{s+i}.t - P_{s}.t}{P_{s+k}.t - P_{s}.t}$ = $\frac{P_{s+i}.t - P_{s}.t}{P_{s+k}.t - P_{s}.t}$  = 
$\frac{|\vv{P_sP'_{s+i}}|}{|\vv{P_sP_{s+k}}|}$ = 
$\frac{P'_{s+i}.t - P_{s}.x}{P_{s+k}.x - P_{s}.x}$ = $\frac{P'_{s+i}.y - P_{s}.y}{P_{s+k}.y - P_{s}.y}$.
%
Hence, by the definition of synchronized points, we have the conclusion.
\end{proof}






\begin{theorem}
\label{prop-3d-ci}
Given a sub-trajectory $[P_s,...,P_e]$ and an error bound $\epsilon$, there exists a point $Q$ such that $Q.t = P_e.t$ and $sed(P_i, \vv{P_sQ})<\epsilon$ for each $i \in (s,e]$ if and only if $\bigsqcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$.
\end{theorem}

\begin{proof}
Let $P'_i$ be the intersection point of the line segment $\vv{P_sQ}$ and the plane $t=t_i$.
By Lemma~\ref{prop-3d-syn-point}, the point $P'_i$ is the synchronized data point of $P_i$ \wrt the line segment $\vv{P_sQ}$.

\ni (1) If $\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$, then there must exits a point $Q = (x,y,t_e)$ within the circle $\mathcal{O}(P_e, \epsilon)$ of $P_e$ such that $\vv{P_sQ}$ passes through the intersection of all the cones. Hence it pass through all circles $\mathcal{O}(P_i, \epsilon)$ for $i \in (s, e]$, and the intersection point, $P'_i$, is sure within the circle $\mathcal{O}(P_i, \epsilon)$. Thus, $sed(P_i, \vv{P_sQ}) = |P'_iP_i| < \zeta$, for $i \in (s, e]$.

\ni (2) If there exists a point $Q$, $Q.t = P_e.t$, such that $sed(P_i, \vv{P_sQ})<\epsilon$ for all $P_i$, $i \in [s,e]$, then $|P'_iP_i| < \zeta$ for all $i \in (s, e]$. Hence, $\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$.

We have the conclusion.
\end{proof}


Theorem~\ref{prop-3d-ci} tells us that ...


\begin{figure}[tb!]
\centering
\includegraphics[scale=0.6]{figures/Fig-cis.png}
\vspace{-2ex}
\caption{\small Examples of spatio-temporal cones. A spatio-temporal cone is an oblique circular cone whose bottom circle and projection circle are parallel to the x-y plane. }
\vspace{-2ex}
\label{fig:cis}
\end{figure}
%Note that the projection circle $\mathcal{O}(P^i_{i+1}, r^i_{i+1})$ is on the plane $t=t_i$.




%\vspace{1ex}

\begin{prop}
\label{prop-circle-intersection}
Given time $t_c > t_s$, there exists a point $Q$, $Q.t = P_e.t$, such that $sed(P_i, \vv{P_sQ})<\epsilon$ for all points $P_i$, $i \in [s,e]$, if and only if $\bigcap_{i=s+1}^{e}{\mathcal{O}(P^c_i, r^c_i)} \ne \emptyset$.
\end{prop}


\begin{proof}
These oblique circular cones have the same vertex $P_s$ and their bottom circles are parallel, thus,
 ``$\bigcap_{i=1}^{e}{\mathcal{O}(P^c_i, r^c_i)} \ne \phi$, $t_c > t_s$" is naturally equivalent to ``$\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$".
For example, in Figure~\ref{fig:sed3d}, $\mathcal{O}(P^i_{i+1}, r^i_{i+1})$ is the projection circle of synchronous circle $\mathcal{O}(P_{i+1}, \epsilon)$ on the plane $t=t_i$, then ``${\mathcal{O}(P^i_{i+1}, r^i_{i+1})} \bigcap{\mathcal{O}(P_i, \epsilon)} \ne \emptyset$" is equal to ``$\mathcal{C}(P_s, P_i, \epsilon) \bigcap {\mathcal{C}(P_s, P_{i+1}, \epsilon)} \ne \{P_s\}$".
Hence, by Theorem~\ref{prop-3d-ci}, we have the conclusion.
\end{proof}

Proposition~\ref{prop-circle-intersection} tells us that ...


Moreover, the checking of intersection of these 3D cones could be enforced by a more simple way, \ie the checking of the intersection of circles on a plane, \ie intersection of cone projection circles.


%In the spatio-temporal space, the notion \emph{cone} of cone intersection \cite{Williams:Longest, Sklansky:Cone} (or \emph{sector} in sleeve \cite{Zhao:Sleeve}) algorithm is extended to a new notion in 3D space, \ie the \emph{spatio-temporal cone}.

\subsection{Approximating Circles with Regular Polygons}
Finding the common intersection of $N$ circles has a ${O(N\log N)}$ time~\cite{Shamos:Circle}, which is not linear.
To develop a one pass spatio-temporal simplification algorithm, we provide an approximate circles intersection method.
That is, we further replace a circle $\mathcal{O}(P, r)$ to a specially designed $M$-edges inscribed regular polygon,
then we check the intersection of the regular polygons instead of the checking of circles intersection.
Obviously, the intersection of regular polygons is only a sufficient condition of the intersection of the corresponding circles , and
algorithms employ this policy may loss some compression ratio.
And, a larger $M$ would lead to a better compression ratio and a poorer efficiency.
\textcolor[rgb]{0.00,0.07,1.00}{The setting of $M$ is studied in Section 4.}
% In a summary, region $[12, 20]$ are the candidate selections of $M$.

\stitle{Inscribed regular polygons ($\mathcal{G}$)}.
Given a cone projection circle $\mathcal{O}(P, r)$, its inscribed $m$-edge regular polygon $\mathcal{G}(V, E)$,
where $V=\{v_1, \ldots, v_{m}\}$ is the set of vertexes and
$E= \{\overline{v_mv_1}\} \bigcup \{\overline{v_jv_{j+1}}\ |\ j\in [1, m-1]\}$ is the set of edges,
and its vertexes are defined by a polar coordinate system whose  origin is $P$, the center of circle \circle{} as follows:


\vspace{-1ex}
\begin{equation*}
\label{equ-regular-polygon}
%\hspace{-1.5ex}
    \begin{aligned}
        \hspace{10ex}  v_j = (r, \frac{(j-1)}{m}2\pi), ~j \in [1, m].\\
    \end{aligned}
\end{equation*}
\vspace{-1ex}

%\stitle{intersection polygons ($\mathcal{G}^*$)}.

Figure~\ref{fig:polygons}-(1) illustrates an inscribed regular octagon of a cone projection  circle \circle{(P, r)}.

%The intersection of two M-edges convex polygons has a time complexity of $O(M)$ \cite{ORourke:Intersection}.
The regular polygons built by equation (3) have elegant properties, which is helpful to derive an algorithm of linear time and constant space
for the intersection of $N$ regular polygons. We show this based on a notion of \emph{edge group}.


\stitle{Edge groups}.
Let $e_{i,j} = \overline{v_{i,j}v_{i,j+1}}$, $j\in [1,M)$, or $e_{i,j} = \overline{v_{i,M}v_{i,1}}$, $j = M$, be an edge of an approximate polygon
$\mathcal{G}_i$, then all $e_{i,j}$, $i\in [1, k]$, form an \emph{edge group}, namely the $j^{th}$ edge group.
%
For example, in Figure~\ref{fig:polygons}-(2), all the $1^{th}$ edges form the $1^{th}$ edge group.
%
We also use notation $g(e)$ to denote the edge group of an edge $e$, \ie $g(e_{i,j})=j$.



\begin{figure}[tb!]
\centering
\includegraphics[scale=0.88]{figures/Fig-polygons.png}
\vspace{-1ex}
\caption{\small Regular octagons and their intersections.}
\vspace{-2ex}
\label{fig:polygons}
\end{figure}



\begin{theorem}
\label{prop-rp-intersection}
If $\mathcal{G}_i$, $i \in [1, k]$, are M-edges regular polygons on a plane which are built by equation (3), then the intersection polygon
$\mathcal{G}^*_k$ of all $\mathcal{G}_i$ includes at most one edge from an edge group, \eg the $j^{th}$ edge group.
\end{theorem}


\begin{proof}
We prove this by contradiction.

Suppose $\mathcal{G}^*_k$ have two different edges, $e_{h,j}$ and $e_{l,j}$, $h\ne l$, belonging to the $j^{th}$ edge group. Obviously, edge
$e_{h,j}$ belongs to regular polygon $\mathcal{G}_h$, edge $e_{l,j}$ belongs to regular polygon $\mathcal{G}_l$ and $e_{h,j}$ is parallel to
$e_{l,j}$.

If $\mathcal{G}_l \bigcap \mathcal{G}_h = \phi$, then $\mathcal{G}^*_k=\phi$, which conflicts with the hypothetic premises.

If $\mathcal{G}_l \bigcap \mathcal{G}_h \ne \phi$, then the intersection polygon of $\mathcal{G}_h$ and $\mathcal{G}_l$ must include at most
one edge of $e_{h,j}$ and $e_{l,j}$, which is also the contradiction with the hypothetic premises.

Hence, the intersection polygon $\mathcal{G}^*_k$ includes at most one edge of an edge group.
%
%There are at most $M$ edge groups, thus, the intersection polygon $\mathcal{G}^*$ has no more than $M$ edges.
\end{proof}



For example, in Figure~\ref{fig:polygons}-(2), the intersection polygon (red lines) of $\mathcal{G}_1$, $\mathcal{G}_2$ and $\mathcal{G}_3$ has 7 edges, marked 1, 2, 3, 5-8, each from a different edge group. Note the $4^{th}$ edge group has no contribution to the intersection polygon.

\begin{prop}
\label{prop-cpi-time}
The computing of the intersection polygon of polygons $\mathcal{G}^*_k$ and $\mathcal{G}_{k+1}$ can be implemented in a constant time, \ie $O(M)$, by the \cpia algorithm.
\end{prop}

\begin{proof}
By Theorem~\ref{prop-rp-intersection}, the intersection polygon $\mathcal{G}^*_k$ of all approximate polygon $\mathcal{G}_i$, $i \in [1, k]$, has no more than $M$ edges.
We know the convex polygon intersection algorithm, \ie \cpia, of Figure~\ref{alg:c-poly-inter} has a time complexity of $O(|\mathcal{G}^*_k| + |\mathcal{G}_{k+1}|)$, which is $O(2M)$ here, thus, the computing of the intersection of polygons $\mathcal{G}^*_k$ and $\mathcal{G}_{k+1}$ can be implemented in a constant time, \ie $O(M)$, by the \cpia algorithm.
\end{proof}



Based on the notion of spatio-temporal cone, we further check the intersection of 3D cones, similar as the checking of intersection of 2D cones, to find whether there exists a line starting from $P_s$ and approximating these points.


Let $P_s$ be the original of coordination, we demonstrate the \sed and the synchronized points in the spatio-temporal space, as shown in Figure~\ref{fig:sed3d}.
From the spatio-temporal space, we have the following findings.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{sec-3.3-polygon}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



