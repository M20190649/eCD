%\section{One-pass Spatio-temporal data simplification}
\section{One-pass \sed checking method}

In this section, we first discuss the properties of synchronized data points and \sed, then we present a novel \sed checking method by extending the idea of cone intersection.
Finally, we provide a one-pass, error-bounded and \sed enabled trajectory simplification algorithm.



\subsection{Properties of \sed} %and synchronous points     %Spatio-temporal Data
Recall in its definition, the \sed of point $P_i$ to a directed line segment $\mathcal{L} = \vv{P_{s}P_{e}}$, denoted as $sed(P_i, \mathcal{L})$, is $|P_iP_i'|$, the distance from $P_i$ to its synchronized point $P_i' (x_i', y_i', t_i)$ \wrt $\mathcal{L}$.
We first demonstrate the \sed and the synchronized points in the spatio-temporal space, as shown in Figure~\ref{fig:sed3d}.
From the spatio-temporal space, we have the following findings.




%\textcolor[rgb]{1.00,0.00,0.00}{The \sed is demonstrated in 2D space in the previews works~\cite{Meratnia:Spatiotemporal, Chen:Fast, Muckell:Compression, Popa:Spatio}. However,  the trajectory and the \sed are also capable presented in 3D space.}

\begin{lemma}
\label{prop-3d-syn-point}
Given a sub trajectory $[P_s, \ldots, P_e]$ and a point $P_i$, $s<i<e$, the intersection point $P'_i$ of the plane $t=t_i$ and the directed line segment $\mathcal{L} = \vv{P_sP_e}$ is the synchronized data point of $P_i$ \wrt $\mathcal{L}$ in the spatio-temporal space.
\end{lemma}

\begin{proof}
As shown in Figure~\ref{fig:sed3d}, the point $P'_i (x'_i, y'_i, t'_i)$ is the intersection point of the plane $t=t_i$ and the directed line segment $\mathcal{L} = \vv{P_sP_e}$, thus, $t'_i = t_i$ and $\frac{t'_i - t_s}{t_e - t_s}$ = $\frac{t_i - t_s}{t_e - t_s}$  = $\frac{|P_sP'_i|}{|P_sP_e|}$ = $\frac{x'_i - x_s}{x_e - x_s}$ = $\frac{y'_i - y_s}{y_e - y_s}$. Hence, $x'_i = x_s +  \frac{t_i-t_s}{t_e - t_s}(x_e - x_s)$ and $y'_i = y_s +  \frac{t_i - t_s}{t_e - t_s}(y_e - y_s)$, which satisfies the definition of the synchronized data point $P_i$ \wrt $\vv{P_sP_e}$.
\end{proof}




%\begin{definition}
%\label{def:scircle}
\stitle{Synchronous Circles ($\mathcal{O})$}. The synchronous circle of point $P_i$, denoted as $\mathcal{O}(P_i, \epsilon)$, is a circle on the plane $t=t_i$, taking $P_i$ as the center point and having radius of $\epsilon$. %(see Figure~\ref{fig:sed3d}).
%\end{definition}

For example, in Figure~\ref{fig:sed3d}, the point $P_i$ has a synchronous circles $\mathcal{O}(P_i, \epsilon)$. All points in the circle have distances (\ie \sed) less than $\epsilon$ to $P_i$.

With Lemma~\ref{prop-3d-syn-point} and the notion of \emph{synchronous circle}, and from the geometrical perspective, we have Theorem~\ref{prop-3d-sed-sim}.

\begin{theorem}
\label{prop-3d-sed-sim}
Given a sub trajectory $[P_s, \ldots, P_e]$ and a constant $\epsilon$, the sub trajectory can be represented by the line segment $\vv{P_sP_e}$ if and only if the line segment passes through all synchronous circles $\mathcal{O}(P_i, \epsilon)$ for $i \in (s, e)$.
\end{theorem}

\begin{proof}
As shown in Figure~\ref{fig:sed3d}, let $P'_i$ be the intersection point of the line segment $\vv{P_sP_e}$ and the plane $t=t_i$.
By Lemma~\ref{prop-3d-syn-point}, the point $P'_i$ is the synchronized data point of $P_i$ \wrt line segment $\vv{P_sP_e}$.

(1) If the line segment $\vv{P_sP_e}$ passes through all synchronous circles $\mathcal{O}(P_i, \epsilon)$ for $i \in (s, e)$, then by the definition of synchronous circle, it must pass through the circle which is on the plane $t=t_i$ and around point $P_i$, and has a radius of $\epsilon$, thus, $|P'_iP_i| <\epsilon$. Furthermore, the property is hold for each $i \in (s, e)$, hence, the sub trajectory $[P_s, \ldots, P_e]$ can be represented by the line segment $\vv{P_sP_e}$.

(2) If the sub trajectory $[P_s, \ldots, P_e]$ can be represented by the line segment $\vv{P_sP_e}$, then $|P'_iP_i| <\epsilon$ for each $i \in (s, e)$, \ie $P'_i$ is in the synchronous circles $\mathcal{O}(P_i, \epsilon)$. Thus, the line segment $\vv{P_sP_e}$ passes through all synchronous circles $\mathcal{O}(P_i, \epsilon)$ for $i \in (s, e)$.

We have the conclusion.
\end{proof}


\begin{figure}[tb!]
\centering
\includegraphics[scale=0.6]{figures/Fig-SEDin3D.png}
\vspace{-1ex}
\caption{\small Trajectory simplification in the Spatio-temporal space. Note the synchronous circle $\mathcal{O}(P_i, \epsilon)$ is on the plane $t=t_i$.}
\vspace{-3ex}
\label{fig:sed3d}
\end{figure}


%A sub trajectory $\{P_s, \ldots, P_e\}$ is represented by a line segment $\overline{P_sP_e}$
%which passes through the circle on the plane $t=t_i$ and around point $P_i$, for each $s<i<e$.}


\subsection{Spatio-temporal cone intersection}

In this section, we expand the \emph{cone intersection} method from a 2D space, \ie the $x$-$y$ space, to a 3D space, \ie the spatio-temporal space.
In the spatio-temporal space, the notion \emph{cone} of the cone intersection \cite{Williams:Longest, Sklansky:Cone} (or \emph{sector} of sleeve \cite{Zhao:Sleeve}) algorithm is extended to a new notion, \ie the \emph{spatio-temporal cone}.

\stitle{Spatio-temporal cones ($\mathcal{C}$)}. Given a sub trajectory $\{P_s,...,P_e\}$ and a constant $\epsilon$, the spatio-temporal cone of point $P_i$ \wrt point $P_s$, denoted as $\mathcal{C}(P_s, P_i, \epsilon)$, is an oblique circular cone which takes the start point $P_s$ as its vertex and the synchronous circle $\mathcal{O}(P_i, \epsilon)$ as its bottom circle.

For example, in Figure~\ref{fig:cis}, the points $P_s$ and $P_i$ forms an spatio-temporal cone $\mathcal{C}(P_s, P_i, \epsilon)$, and the points $P_s$ and $P_{i+1}$ forms another spatio-temporal cone $\mathcal{C}(P_s, P_{i+1}, \epsilon)$.

Based on the notion of spatio-temporal cone, we further use a novel 3D cone intersection method to check whether there exists a line start from $P_s$ approximating these points.

\begin{theorem}
\label{prop-3d-ci}
Given a sub trajectory $[P_s,...,P_e]$ and a constant $\epsilon$, there exists a point $Q$, $Q.t = P_e.t$, such that $sed(P_i, \vv{P_sQ})<\epsilon$ for all $P_i$, $i \in [s,e]$, if and only if $\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$.
\end{theorem}

\begin{proof}
Let $P'_i$ be the intersection point of the line segment $\vv{P_sQ}$ and the plane $t=t_i$.
By Lemma~\ref{prop-3d-syn-point}, the point $P'_i$ is the synchronized data point of $P_i$ \wrt the line segment $\vv{P_sQ}$.


(1) If $\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$, then there must exits a point $Q = (x,y,t_e)$ within the circle $\mathcal{O}(P_e, \epsilon)$ of $P_e$ such that $\vv{P_sQ}$ passes through the intersection of all the cones. Hence it pass through all circles $\mathcal{O}(P_i, \epsilon)$ for $i \in (s, e]$, and the intersection point, $P'_i$, is sure within the circle $\mathcal{O}(P_i, \epsilon)$. Thus, $sed(P_i, \vv{P_sQ}) = |P'_iP_i| < \zeta$, for $i \in (s, e]$.

(2) If there exists a point $Q$, $Q.t = P_e.t$, such that $sed(P_i, \vv{P_sQ})<\epsilon$ for all $P_i$, $i \in [s,e]$, then $|P'_iP_i| < \zeta$ for all $i \in (s, e]$. Hence, $\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$.

We have the conclusion.
\end{proof}


\begin{figure}[tb!]
\centering
\includegraphics[scale=0.6]{figures/Fig-cis.png}
%\vspace{-1ex}
\caption{\small Examples of spatio-temporal cones. A spatio-temporal cone is an oblique circular cone whose bottom circle and projection circle are parallel to the x-y plane. }
\vspace{-2ex}
\label{fig:cis}
\end{figure}
%Note that the projection circle $\mathcal{O}(P^i_{i+1}, r^i_{i+1})$ is on the plane $t=t_i$.

The checking of intersection of these cones could be enforced by a more simple way, \ie the checking of the intersection of circles on a plane.

\stitle{Projection circles}. Given time $t_c > t_s$, the projection of the synchronous circle $\mathcal{O}(P_i, \epsilon)$ of point $P_i$ on the plane $t=t_c$ is a circle, denoted as $\mathcal{O}(P^c_i, r^c_i)$, where $P^c_i$ =  $(x^c_i, y^c_i, t_c)$ satisfying:


\vspace{-1ex}
\begin{equation*}
\label{equ-proj-circle-xy}
\hspace{10ex} \left\{
    \begin{aligned}
        & x^c_i = x_s +  \frac{t_c - t_s}{t_i - t_s}(x_i - x_s) \\
        & y^c_i = y_s +  \frac{t_c - t_s}{t_i - t_s}(y_i - y_s) \\
    \end{aligned}
    \right.       \hspace{12ex}(1)
\end{equation*}
\vspace{-1ex}

and

\vspace{-2ex}
\begin{equation*}
\label{equ-proj-circle-r}
    \begin{aligned}
        \hspace{17ex}  r^c_i =\frac{t_c-t_s}{t_i-t_s}{\epsilon}   \hspace{20ex}(2) \\
    \end{aligned}
\end{equation*}
\vspace{-1ex}



For example, in Figure~\ref{fig:cis}, the red dash circle on plane $t=t_i$, \ie $\mathcal{O}(P^i_{i+1}, r^i_{i+1})$, is the projection circle of the synchronous circle $\mathcal{O}(P_{i+1}, \epsilon)$ on plane $t=t_i$.

\vspace{1ex}

\begin{cor}
\label{prop-circle-intersection}
Given time $t_c > t_s$, there exists a point $Q$, $Q.t = P_e.t$, such that $sed(P_i, \vv{P_sQ})<\epsilon$ for all points $P_i$, $i \in [s,e]$, if and only if $\bigcap_{i=s+1}^{e}{\mathcal{O}(P^c_i, r^c_i)} \ne \phi$.
\end{cor}


\begin{proof}
These oblique circular cones have the same vertex $P_s$ and their bottom circles are parallel, thus,
 ``$\bigcap_{i=1}^{e}{\mathcal{O}(P^c_i, r^c_i)} \ne \phi$, $t_c > t_s$" is naturally equivalent to ``$\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$".
For example, in Figure~\ref{fig:sed3d}, $\mathcal{O}(P^i_{i+1}, r^i_{i+1})$ is the projection circle of synchronous circle $\mathcal{O}(P_{i+1}, \epsilon)$ on the plane $t=t_i$, then ``${\mathcal{O}(P^i_{i+1}, r^i_{i+1})} \bigcap{\mathcal{O}(P_i, \epsilon)} \ne \phi$" is equal to ``$\mathcal{C}(P_s, P_i, \epsilon) \bigcap {\mathcal{C}(P_s, P_{i+1}, \epsilon)} \ne \{P_s\}$".
Hence, by Theorem~\ref{prop-3d-ci}, we have the conclusion.
\end{proof}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{sec-3.3-polygon}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



