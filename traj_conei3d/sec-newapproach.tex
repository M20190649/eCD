%\section{One-pass Spatio-temporal data simplification}
\section{Local One-Pass Distance Checking}

In this section, we first analyze the properties of synchronized points and synchronous Euclidean distances, then we present a local one-pass \sed checking method by extending the cone intersection for \ped checking in Section~\ref{sub-ci-ped}.
%Finally, we provide a one-pass, error-bounded and \sed enabled trajectory simplification algorithm.



\subsection{Properties of \sed} %and synchronous points     %Spatio-temporal Data
Recall that the \sed of point $P_i$ to a directed line segment $\mathcal{L} = \vv{P_{s}P_{e}}$, denoted as $sed(P_i, \mathcal{L})$, is $|P_iP_i'|$, the distance from $P_i$ to its synchronized point $P_i' (x_i', y_i', t_i)$ \wrt $\mathcal{L}$.
Let $P_s$ be the original of coordination, we demonstrate the \sed and the synchronized points in the spatio-temporal space, as shown in Figure~\ref{fig:sed3d}.
From the spatio-temporal space, we have the following findings.


%\textcolor[rgb]{1.00,0.00,0.00}{The \sed is demonstrated in 2D space in the previews works~\cite{Meratnia:Spatiotemporal, Chen:Fast, Muckell:Compression, Popa:Spatio}. However,  the trajectory and the \sed are also capable presented in 3D space.}

\begin{lemma}
\label{prop-3d-syn-point}
Given a sub trajectory $[P_s, \ldots, P_e]$ and a point $P_i$, $s<i<e$, the intersection point $P'_i$ of the directed line segment $\mathcal{L} = \vv{P_sP_e}$ and the plane $t=t_i$ is the synchronized data point of $P_i$ \wrt $\mathcal{L}$,
and the distance from point $P_i$ to point $P'_i$, $|P_iP'_i|$, is the \sed of $P_i$ \wrt $\vv{P_sP_e}$.
%in the spatio-temporal space.
\end{lemma}

\begin{proof}
As shown in Figure~\ref{fig:sed3d}, the point $P'_i (x'_i, y'_i, t'_i)$ is the intersection point of the directed line segment $\mathcal{L} = \vv{P_sP_e}$ and the plane $t=t_i$, thus, $t'_i = t_i$ and $\frac{t'_i - t_s}{t_e - t_s}$ = $\frac{t_i - t_s}{t_e - t_s}$  = $\frac{|P_sP'_i|}{|P_sP_e|}$ = $\frac{x'_i - x_s}{x_e - x_s}$ = $\frac{y'_i - y_s}{y_e - y_s}$. Hence, $x'_i = x_s +  \frac{t_i-t_s}{t_e - t_s}(x_e - x_s)$ and $y'_i = y_s +  \frac{t_i - t_s}{t_e - t_s}(y_e - y_s)$, which satisfies the definition of the synchronized data point $P_i$ \wrt $\vv{P_sP_e}$.
\end{proof}



%\begin{definition}
%\label{def:scircle}
\stitle{Synchronous Circles ($\mathcal{O})$}. The synchronous circle of point $P_i$, denoted as $\mathcal{O}(P_i, \epsilon)$, is a circle on the plane $t=t_i$, taking $P_i$ as the center point and having radius of $\epsilon$. %(see Figure~\ref{fig:sed3d}).
%\end{definition}
In Figure~\ref{fig:sed3d}, \eg point $P_i$ has a synchronous circles $\mathcal{O}(P_i, \epsilon)$, and any point $P'_i$ in the circle has a distance less than $\epsilon$ to $P_i$.

Note that in this definition, a \emph{synchronous circle} $\mathcal{O}(P_i, \epsilon)$ is only defined by a central point $P_i$ and a constant $\epsilon$. Indeed, it is nothing to do with any start point $P_s$ or end point $P_e$.

With Lemma~\ref{prop-3d-syn-point} and the notion of \emph{synchronous circle}, and from the geometrical perspective, we have Theorem~\ref{prop-3d-sed-sim}.

\begin{figure}[tb!]
\centering
\includegraphics[scale=0.56]{figures/Fig-SEDin3D.png}
\vspace{-1ex}
\caption{\small Trajectory simplification in the Spatio-temporal space. Note the synchronous circle $\mathcal{O}(P_i, \epsilon)$ is on plane $t=t_i$.} %
\vspace{-3ex}
\label{fig:sed3d}
\end{figure}


\begin{theorem}
\label{prop-3d-sed-sim}
Given a sub-trajectory $[P_s, \ldots, P_e]$ and an error bound $\epsilon$, the sub-trajectory can be represented by the line segment $\vv{P_sP_e}$ if and only if the line segment passes through all synchronous circles $\mathcal{O}(P_i, \epsilon)$ for each $i \in (s, e]$.
\end{theorem}

\begin{proof}
As shown in Figure~\ref{fig:sed3d}, let $P'_i$ be the intersection point of line segment $\vv{P_sP_e}$ and plane $t=t_i$.
By Lemma~\ref{prop-3d-syn-point}, point $P'_i$ is the synchronized point of $P_i$ \wrt line segment $\vv{P_sP_e}$.

\ni (1) If the line segment $\vv{P_sP_e}$ passes through all synchronous circles $\mathcal{O}(P_i, \epsilon)$ for $i \in (s, e)$, then by the definition of synchronous circle, it must pass through the circle which is on the plane $t=t_i$ and around point $P_i$, and has a radius of $\epsilon$, thus, $|P'_iP_i| <\epsilon$. Furthermore, the property is hold for each $i \in (s, e)$, hence, the sub trajectory $[P_s, \ldots, P_e]$ can be represented by the line segment $\vv{P_sP_e}$.

\ni (2) If the sub trajectory $[P_s, \ldots, P_e]$ can be represented by the line segment $\vv{P_sP_e}$, then $|P'_iP_i| <\epsilon$ for each $i \in (s, e)$, \ie $P'_i$ is in the synchronous circles $\mathcal{O}(P_i, \epsilon)$. Thus, the line segment $\vv{P_sP_e}$ passes through all synchronous circles $\mathcal{O}(P_i, \epsilon)$ for $i \in (s, e)$.

We have the conclusion.
\end{proof}





%A sub trajectory $\{P_s, \ldots, P_e\}$ is represented by a line segment $\overline{P_sP_e}$
%which passes through the circle on the plane $t=t_i$ and around point $P_i$, for each $s<i<e$.}


\subsection{Spatio-temporal Cone Intersection}

We next extend the \emph{cone intersection} method \cite{Williams:Longest, Sklansky:Cone, Zhao:Sleeve} from a 2D space, \ie the $x$-$y$ space, to a 3D space, \ie the spatio-temporal space.
In the spatio-temporal space, the notion \emph{cone} of cone intersection \cite{Williams:Longest, Sklansky:Cone} (or \emph{sector} in sleeve \cite{Zhao:Sleeve}) algorithm is extended to a new notion in 3D space, \ie the \emph{spatio-temporal cone}.

\stitle{Spatio-temporal cones ($\mathcal{C}$)}. Given a sub trajectory $\{P_s,...,P_e\}$ and a constant $\epsilon$, the spatio-temporal cone of point $P_i$ \wrt point $P_s$, denoted as $\mathcal{C}(P_s, P_i, \epsilon)$, is an oblique circular cone which takes the start point $P_s$ as its vertex and the synchronous circle $\mathcal{O}(P_i, \epsilon)$ as its bottom circle.

For example, in Figure~\ref{fig:cis}, the points $P_s$ and $P_i$ forms an spatio-temporal cone $\mathcal{C}(P_s, P_i, \epsilon)$, and the points $P_s$ and $P_{i+1}$ forms another spatio-temporal cone $\mathcal{C}(P_s, P_{i+1}, \epsilon)$.

Based on the notion of spatio-temporal cone, we further check the intersection of 3D cones, similar as the checking of intersection of 2D cones, to find whether there exists a line starting from $P_s$ and approximating these points.

\begin{theorem}
\label{prop-3d-ci}
Given a sub trajectory $[P_s,...,P_e]$ and an error bound $\epsilon$, there exists a point $Q$ such that $Q.t = P_e.t$ and $sed(P_i, \vv{P_sQ})<\epsilon$ for each $i \in (s,e]$ if and only if $\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$.
\end{theorem}

\begin{proof}
Let $P'_i$ be the intersection point of the line segment $\vv{P_sQ}$ and the plane $t=t_i$.
By Lemma~\ref{prop-3d-syn-point}, the point $P'_i$ is the synchronized data point of $P_i$ \wrt the line segment $\vv{P_sQ}$.

\ni (1) If $\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$, then there must exits a point $Q = (x,y,t_e)$ within the circle $\mathcal{O}(P_e, \epsilon)$ of $P_e$ such that $\vv{P_sQ}$ passes through the intersection of all the cones. Hence it pass through all circles $\mathcal{O}(P_i, \epsilon)$ for $i \in (s, e]$, and the intersection point, $P'_i$, is sure within the circle $\mathcal{O}(P_i, \epsilon)$. Thus, $sed(P_i, \vv{P_sQ}) = |P'_iP_i| < \zeta$, for $i \in (s, e]$.

\ni (2) If there exists a point $Q$, $Q.t = P_e.t$, such that $sed(P_i, \vv{P_sQ})<\epsilon$ for all $P_i$, $i \in [s,e]$, then $|P'_iP_i| < \zeta$ for all $i \in (s, e]$. Hence, $\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$.

We have the conclusion.
\end{proof}


\begin{figure}[tb!]
\centering
\includegraphics[scale=0.6]{figures/Fig-cis.png}
%\vspace{-1ex}
\caption{\small Examples of spatio-temporal cones. A spatio-temporal cone is an oblique circular cone whose bottom circle and projection circle are parallel to the x-y plane. }
\vspace{-2ex}
\label{fig:cis}
\end{figure}
%Note that the projection circle $\mathcal{O}(P^i_{i+1}, r^i_{i+1})$ is on the plane $t=t_i$.

Moreover, the checking of intersection of these 3D cones could be enforced by a more simple way, \ie the checking of the intersection of circles on a plane. These circles on a plane are defined as follows.

\stitle{Projection circles}. Given time $t_c > t_s$, the projection of the synchronous circle $\mathcal{O}(P_i, \epsilon)$ of $P_i$ on plane $t=t_c$ is a circle, denoted as $\mathcal{O}(P^c_i, r^c_i)$, where $P^c_i$ =  $(x^c_i, y^c_i, t_c)$ satisfying:


\vspace{-1ex}
\begin{equation*}
\label{equ-proj-circle-xy}
\hspace{10ex} \left\{
    \begin{aligned}
        & x^c_i = x_s +  \frac{t_c - t_s}{t_i - t_s}(x_i - x_s) \\
        & y^c_i = y_s +  \frac{t_c - t_s}{t_i - t_s}(y_i - y_s) \\
    \end{aligned}
    \right.       \hspace{12ex}(1)
\end{equation*}
\vspace{-1ex}

and

\vspace{-2ex}
\begin{equation*}
\label{equ-proj-circle-r}
    \begin{aligned}
        \hspace{17ex}  r^c_i =\frac{t_c-t_s}{t_i-t_s}{\epsilon}   \hspace{20ex}(2) \\
    \end{aligned}
\end{equation*}
\vspace{-1ex}



For example, in Figure~\ref{fig:cis}, the red dash circle on plane $t=t_i$, \ie $\mathcal{O}(P^i_{i+1}, r^i_{i+1})$, is the projection circle of the synchronous circle $\mathcal{O}(P_{i+1}, \epsilon)$ on plane $t=t_i$.

%\vspace{1ex}

\begin{cor}
\label{prop-circle-intersection}
Given time $t_c > t_s$, there exists a point $Q$, $Q.t = P_e.t$, such that $sed(P_i, \vv{P_sQ})<\epsilon$ for all points $P_i$, $i \in [s,e]$, if and only if $\bigcap_{i=s+1}^{e}{\mathcal{O}(P^c_i, r^c_i)} \ne \phi$.
\end{cor}


\begin{proof}
These oblique circular cones have the same vertex $P_s$ and their bottom circles are parallel, thus,
 ``$\bigcap_{i=1}^{e}{\mathcal{O}(P^c_i, r^c_i)} \ne \phi$, $t_c > t_s$" is naturally equivalent to ``$\bigcap_{i=s+1}^{e}{\mathcal{C}(P_s, P_i, \epsilon)} \ne \{P_s\}$".
For example, in Figure~\ref{fig:sed3d}, $\mathcal{O}(P^i_{i+1}, r^i_{i+1})$ is the projection circle of synchronous circle $\mathcal{O}(P_{i+1}, \epsilon)$ on the plane $t=t_i$, then ``${\mathcal{O}(P^i_{i+1}, r^i_{i+1})} \bigcap{\mathcal{O}(P_i, \epsilon)} \ne \phi$" is equal to ``$\mathcal{C}(P_s, P_i, \epsilon) \bigcap {\mathcal{C}(P_s, P_{i+1}, \epsilon)} \ne \{P_s\}$".
Hence, by Theorem~\ref{prop-3d-ci}, we have the conclusion.
\end{proof}


\subsection{Intersection of circles }
Finding the common intersection of $N$ circles has a ${O(N\log N)}$ time~\cite{Shamos:Circle}, which is not linear.
To develop a one pass spatio-temporal simplification algorithm, we provide an approximate circles intersection method.
That is, we further replace a circle $\mathcal{O}(P, r)$ to a specially designed $M$-edges inscribed regular polygon,
then we check the intersection of the regular polygons instead of the checking of circles intersection.
Obviously, the intersection of regular polygons is only a sufficient condition of the intersection of the corresponding circles , and
algorithms employ this policy may loss some compression ratio.
And, a larger $M$ would lead to a better compression ratio and a poorer efficiency.
\textcolor[rgb]{0.00,0.07,1.00}{The setting of $M$ is studied in Section 4. In a summary, region $[10, 20]$ are the candidate selections of $M$.}

\stitle{Approximate polygons ($\mathcal{G}$)}.
Given a circle $\mathcal{O}(P, r)$, its approximate polygons is a $M$ edges inscribed regular polygon $\mathcal{G}(V, E)$,
where $V=\{v_1, \ldots, v_{M}\}$ is the set of vertexes and
$E= \{\overline{v_jv_{j+1}}| j\in [1,M-1]\} \bigcup \{\overline{v_Mv_1}\}$ is the set of edges.
Furthermore, let the center point $P$ of the circle be the origin of a polar coordinate system, then each vertex satisfies:

\vspace{-2ex}
\begin{equation*}
\label{equ-regular-polygon}
%\hspace{-1.5ex}
    \begin{aligned}
        \hspace{10ex}  v_j = (r, \frac{2(j-1)}{M}\pi), ~j \in [1, M]    \hspace{10ex} (3)\\
    \end{aligned}
\end{equation*}
\vspace{-1ex}

%\stitle{intersection polygons ($\mathcal{G}^*$)}.

For example, Figure~\ref{fig:polygons}-(1) is a regular octagon whose vertexes satisfying the Equation (3).

%The intersection of two M-edges convex polygons has a time complexity of $O(M)$ \cite{ORourke:Intersection}.
The regular polygons built by equation (3) have elegant properties, which is helpful to derive an algorithm of linear time and constant space
for the intersection of $N$ regular polygons. We show this based on a notion of \emph{edge group}.


\stitle{Edge groups}.
Let $e_{i,j} = \overline{v_{i,j}v_{i,j+1}}$, $j\in [1,M)$, or $e_{i,j} = \overline{v_{i,M}v_{i,1}}$, $j = M$, be an edge of an approximate polygon
$\mathcal{G}_i$, then all $e_{i,j}$, $i\in [1, k]$, form an \emph{edge group}, namely the $j^{th}$ edge group.
%
For example, in Figure~\ref{fig:polygons}-(2), all the $1^{th}$ edges form the $1^{th}$ edge group.
%
We also use notation $g(e)$ to denote the edge group of an edge $e$, \ie $g(e_{i,j})=j$.



\begin{figure}[tb!]
\centering
\includegraphics[scale=0.88]{figures/Fig-polygons.png}
\vspace{-1ex}
\caption{\small Regular octagons and their intersections.}
\vspace{-2ex}
\label{fig:polygons}
\end{figure}



\begin{theorem}
\label{prop-rp-intersection}
If $\mathcal{G}_i$, $i \in [1, k]$, are M-edges regular polygons on a plane which are built by equation (3), then the intersection polygon
$\mathcal{G}^*_k$ of all $\mathcal{G}_i$ includes at most one edge from an edge group, \eg the $j^{th}$ edge group.
\end{theorem}


\begin{proof}
We prove this by contradiction.

Suppose $\mathcal{G}^*_k$ have two different edges, $e_{h,j}$ and $e_{l,j}$, $h\ne l$, belonging to the $j^{th}$ edge group. Obviously, edge
$e_{h,j}$ belongs to regular polygon $\mathcal{G}_h$, edge $e_{l,j}$ belongs to regular polygon $\mathcal{G}_l$ and $e_{h,j}$ is parallel to
$e_{l,j}$.

If $\mathcal{G}_l \bigcap \mathcal{G}_h = \phi$, then $\mathcal{G}^*_k=\phi$, which conflicts with the hypothetic premises.

If $\mathcal{G}_l \bigcap \mathcal{G}_h \ne \phi$, then the intersection polygon of $\mathcal{G}_h$ and $\mathcal{G}_l$ must include at most
one edge of $e_{h,j}$ and $e_{l,j}$, which is also the contradiction with the hypothetic premises.

Hence, the intersection polygon $\mathcal{G}^*_k$ includes at most one edge of an edge group.
%
%There are at most $M$ edge groups, thus, the intersection polygon $\mathcal{G}^*$ has no more than $M$ edges.
\end{proof}



For example, in Figure~\ref{fig:polygons}-(2), the intersection polygon (red lines) of $\mathcal{G}_1$, $\mathcal{G}_2$ and $\mathcal{G}_3$ has 7 edges, marked 1, 2, 3, 5-8, each from a different edge group. Note the $4^{th}$ edge group has no contribution to the intersection polygon.

\begin{cor}
\label{prop-cpi-time}
The computing of the intersection polygon of polygons $\mathcal{G}^*_k$ and $\mathcal{G}_{k+1}$ can be implemented in a constant time, \ie $O(M)$, by the \cpia algorithm.
\end{cor}

\begin{proof}
By Theorem~\ref{prop-rp-intersection}, the intersection polygon $\mathcal{G}^*_k$ of all approximate polygon $\mathcal{G}_i$, $i \in [1, k]$, has no more than $M$ edges.
We know the convex polygon intersection algorithm, \ie \cpia, of Figure~\ref{alg:c-poly-inter} has a time complexity of $O(|\mathcal{G}^*_k| + |\mathcal{G}_{k+1}|)$, which is $O(2M)$ here, thus, the computing of the intersection of polygons $\mathcal{G}^*_k$ and $\mathcal{G}_{k+1}$ can be implemented in a constant time, \ie $O(M)$, by the \cpia algorithm.
\end{proof}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{sec-3.3-polygon}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



